---
title: "GitLab: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞ –≤ pipeline"
date: 2025-11-22
draft: false
tags: ["GitLab"]
---
–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 15.7 –≤ GitLab –µ—Å—Ç—å –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω–∞—è —Ñ–∏—á–∞ - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞ –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ. –û –Ω–µ–π –∏ –ø–æ–≥–æ–≤–æ—Ä–∏–º.

JWT —Ç–æ–∫–µ–Ω—ã –∫–∞–∫ —Ç–∞–∫–æ–≤—ã–µ - –æ—á–µ–Ω—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏, –∏ GitLab —ç—Ç–æ—Ç —Ç—Ä–µ–Ω–¥ –Ω–µ –æ–±–æ—à–µ–ª —Å—Ç–æ—Ä–æ–Ω–æ–π. 

–í –ø–∞–π–ø–ª–∞–π–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤–∏–¥–∞:

```yaml
job1:
  id_tokens:
    SOME_JWT_TOKEN:
      aud: "${EXTERNAL_SYSTEM_ADDRESS}"

```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–ª–∞ job –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω JWT —Ç–æ–∫–µ–Ω —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø–æ–ª–µ–º `aud` (audience claim) –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∏ –µ—â–µ –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª–µ–π –≤ payload. –°–æ–∑–¥–∞–Ω–Ω—ã–π JWT —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω job –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `SOME_JWT_TOKEN`. –î–∞–ª–µ–µ —Å–∫—Ä–∏–ø—Ç –º–æ–∂–µ—Ç –Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä–∏–ª–æ–∂–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –∫ –∑–∞–≥–æ–ª–æ–≤–∫—É HTTP –∑–∞–ø—Ä–æ—Å–∞.

GitLab –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–∏ JWT —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞, –∞ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏ –ø—É–±–ª–∏–∫—É–µ—Ç –Ω–∞ url: `<gitlab_root>/oauth/discovery/keys`

–í–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –≤ –∫–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω GitLab –≤–∫–ª—é—á–∞–µ—Ç —Ç–æ–Ω–Ω—É –ø–æ–ª–µ–∑–Ω—ã—Ö –ø–æ–ª–µ–π, –∫–∞–∫ —Ç–æ: projectId, branchName, environmentName –∏ –º–Ω–æ–≥–æ —á–µ–≥–æ –µ—â–µ (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ [–∑–¥–µ—Å—å](https://docs.gitlab.com/ci/secrets/.id_token_authentication/)).

## –í —á–µ–º –ø–æ–ª—å–∑–∞
–¶–∏–º–µ—Å –≤ —Ç–æ–º, —á—Ç–æ —Å —ç—Ç–∏–º –ø–æ–¥—Ö–æ–¥–æ–º –º—ã –º–æ–∂–µ–º –¥–∞—Ç—å GitLab –¥–æ—Å—Ç—É–ø –≤–æ –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É, –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–∏–∫–∞–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ GitLab ü§©

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –º—ã —Ö–æ—Ç–∏–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞—à–µ–º—É GitLab —Å–µ—Ä–≤–µ—Ä—É –¥–æ—Å—Ç—É–ø –≤ –Ω–µ–∫—É—é –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É, —Ç–æ–≥–¥–∞ –º—ã –º–æ–∂–µ–º:
- —Å–æ–æ–±—â–∏—Ç—å –µ–π URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è GitLab public keys
- –≤–∫–ª—é—á–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø—Ä–∏ –ø–æ–º–æ—â–∏ JWT —Ç–æ–∫–µ–Ω–∞
- –∑–∞–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –µ–≥–æ –ø–æ–ª–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä
    - aud=external-system-url
    - project_id=x
    - environment=production

## –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
–°—Ö–µ–º–∞—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
```mermaid
sequenceDiagram
    participant G as GitLab Server
    participant E as External System
    participant K as GitLab Public Keys Endpoint

    G->>G: Generate JWT token with claims

    G->>+E: API Request with JWT token<br/>Authorization: Bearer <jwt_token>
    
    E->>+K: GET /oauth/discovery/keys
    K-->>-E: Return JWKS (JSON Web Key Set)
    
    E->>E: 1. Validate JWT token signature
    E->>E: 1. Validate JWT token claims
    
    alt Token is valid
        E-->>G: 200 OK + Requested Data
    else Token is invalid
        E-->>G: 401 Unauthorized
    end
```

## –ö–∞–∫ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
–ï—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–∞–∫–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
- **–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å–µ–∫—Ä–µ—Ç–æ–≤**. –ù–∞–∏–±–æ–ª–µ–µ —É–ø–æ—Ç—Ä–µ–±–∏–º—ã–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π - —ç—Ç–æ —Ö–æ–¥–∏—Ç—å –∑–∞ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –≤ secret providers —Ç–∞–∫–∏–µ –∫–∞–∫ HashiCorp Vault, OpenBao –∏ —Ç. –¥. –•—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã —Ä–æ—Å—Å—ã–ø—å—é –≤ CI/CD –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–∑–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤, –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥—Ä—É–ø–ø –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –≤ GitLab - —ç—Ç–æ –±–æ–ª—å. –î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–±—Ä–∞—Ç—å –≤—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ–∫—Ä–µ—Ç–æ–≤.
- **–û–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**. –í—ã–∫–ª–∞–¥–∫–∞ –≤ –æ–±–ª–∞–∫–∞ –∏–ª–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã - —ç—Ç–æ –¥—Ä—É–≥–æ–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π.
- **Custom applications**. –í —Ä–æ–ª–∏ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–µ —Å–≤–æ–µ –∫–∞—Å—Ç–æ–º–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç JWT –∞—É–Ω—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–∏.